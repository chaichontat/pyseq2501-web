var O=Object.defineProperty,N=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var b=(t,e,s)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,r=(t,e)=>{for(var s in e||(e={}))C.call(e,s)&&b(t,s,e[s]);if(S)for(var s of S(e))j.call(e,s)&&b(t,s,e[s]);return t},_=(t,e)=>N(t,W(e));import{D as P}from"./vendor-b4247f54.js";const T={pump:{reagent:"",volume:0,op:"pump"},prime:{reagent:"",volume:0,op:"prime"},temp:{temp:25,wait:!0,op:"temp"},hold:{time:0,op:"hold"},takeimage:{name:"Test",path:".",xy0:[0,0],xy1:[1,1],channels:[!0,!0,!0,!0],z_tilt:19850,z_obj:32e3,save:!1,lasers:[0,0],laser_onoff:[!0,!0],od:[0,0],overlap:.1,op:"takeimage",z_from:0,z_to:0,z_spacing:232},autofocus:{channels:[!0,!0,!0,!0],laser_onoff:!0,laser:5,od:0,op:"autofocus"},goto:{step:1,n:4,op:"goto"}},$={name:"",port:1,v_pull:100,v_prime:200,v_push:2e3,wait:26},k={name:"",path:".",fc:!1,reagents:[{uid:0,reagent:r({},$)}],cmds:[{uid:0,cmd:r({},T.pump)}]};function H(t,e){return{name:t.name,fc:t.fc,path:t.path,reagents:t.reagents.map(s=>({uid:++e,reagent:s})),cmds:t.cmds.map(s=>({uid:++e,cmd:s}))}}function U(t){return{name:t.name,fc:t.fc,path:t.path,reagents:t.reagents.map(e=>e.reagent),cmds:t.cmds.map(e=>e.cmd)}}const L={x:-1,y:-1,z_tilt:[-1,-1,-1],z_obj:-1,od:[0,0],laser_onoff:[!0,!0],lasers:[-1,-1],shutter:!1,msg:""},g=[2e3,5e3,1e4,3e4,6e4];function w(t,e,{f:s=JSON.parse,broadcastOnSet:m,beforeOpen:u,onClose:h}={}){let a,f,c,l=0;const i=new Set;function E(){const o=l;return l++,g[o>=g.length-1?g.length-1:o]}function x(){c&&clearTimeout(c),a.readyState!==WebSocket.CLOSED&&a.close()}function z(){x(),h&&h(),i.size>0&&(c=setTimeout(()=>d(),E()))}async function d(){return c&&(clearTimeout(c),c=void 0),u&&await u(),a=new WebSocket(t),a.onmessage=o=>{console.log(o.data),i.forEach(n=>{e=s(o.data),n(e)})},a.onclose=o=>z(),f=new Promise((o,n)=>{a.onerror=p=>{console.error("Websocket error"),n(p)},a.onopen=p=>{l=0,o(!0)}}),f}return d(),{set(o){console.log(o);const n=typeof o=="object"?()=>a.send(JSON.stringify(o)):()=>a.send(o);if(a)switch(a.readyState){case(WebSocket.CLOSED||WebSocket.CLOSING):{d().then(n);break}case WebSocket.CONNECTING:{f.then(n);break}case WebSocket.OPEN:{n();break}}m&&i.forEach(p=>p(o))},update(o){i.forEach(n=>n(o(e)))},subscribe(o){return o(e),i.add(o),()=>i.delete(o)}}}const D={block:"",max_uid:2,mode:"editingA",exps:[r({},k),r({},k)],image_params:_(r({},T.takeimage),{fc:!1})},q=w(`ws://${window.location.hostname}:8000/status`,r({},L)),y=P(r({},D)),G=w(`ws://${window.location.hostname}:8000/user`,r({},D),{beforeOpen:I}),B=w(`ws://${window.location.hostname}:8000/cmd`,{msg:"ok"},{broadcastOnSet:!1});async function I(){for(;;)try{const e=await(await fetch(`http://${window.location.hostname}:8000/usersettings`)).json();y.set(e);return}catch{console.error("Cannot get initial user settings."),await new Promise(e=>setTimeout(e,1e3))}}function J(){let t=Date.now(),e=setTimeout(()=>{},1e3);y.subscribe(s=>{let m=Date.now();const u=()=>{G.set(s),t=Date.now()};m-t<1e3?(clearTimeout(e),e=setTimeout(u,1e3-(m-t))):u()})}J();export{T as a,B as c,k as e,H as f,$ as r,q as s,U as t,y as u};

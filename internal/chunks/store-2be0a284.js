var D=Object.defineProperty,x=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var w=(e,t,o)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,s=(e,t)=>{for(var o in t||(t={}))T.call(t,o)&&w(e,o,t[o]);if(g)for(var o of g(t))v.call(t,o)&&w(e,o,t[o]);return e},m=(e,t)=>x(e,z(t));import{D as p}from"./vendor-b4247f54.js";const h={pump:{reagent:"",volume:0,op:"pump"},prime:{reagent:"",volume:0,op:"prime"},temp:{temp:25,wait:!0,op:"temp"},hold:{time:0,op:"hold"},takeimage:{name:"Test",path:".",xy0:[0,0],xy1:[1,1],channels:[!0,!0,!0,!0],z_tilt:19850,z_obj:32e3,save:!1,lasers:[0,0],laser_onoff:[!0,!0],od:[0,0],overlap:.1,op:"takeimage",z_from:0,z_to:0,z_spacing:232},autofocus:{channels:[!0,!0,!0,!0],laser_onoff:!0,laser:5,od:0,op:"autofocus"},goto:{step:1,n:4,op:"goto"}},j={name:"",port:1,v_pull:100,v_prime:200,v_push:2e3,wait:26},b={name:"",path:".",fc:!1,reagents:[{uid:0,reagent:s({},j)}],cmds:[{uid:0,cmd:s({},h.pump)}]};function I(e,t){return{name:e.name,fc:e.fc,path:e.path,reagents:e.reagents.map(o=>({uid:++t,reagent:o})),cmds:e.cmds.map(o=>({uid:++t,cmd:o}))}}function P(e){return{name:e.name,fc:e.fc,path:e.path,reagents:e.reagents.map(t=>t.reagent),cmds:e.cmds.map(t=>t.cmd)}}const O={x:-1,y:-1,z_tilt:[-1,-1,-1],z_obj:-1,od:[0,0],laser_onoff:[!0,!0],lasers:[-1,-1],shutter:!1,msg:"Idle"};function f(e,t,{f:o=JSON.parse,broadcastOnSet:u,beforeOpen:c,localStore:i}={}){let n,r;const{set:l,subscribe:S,update:y}=p(t);async function d(){console.log("Connecting"),r=null,c&&await c(),n=new WebSocket(e),n.onmessage=a=>l(o(a.data)),n.onopen=()=>{i&&i.update(a=>m(s({},a),{connected:!0})),r&&(clearTimeout(r),r=null)},n.onclose=()=>{i&&i.update(a=>m(s({},a),{connected:!1})),r||(r=setTimeout(d,2e3)),console.error("Connection closed.")}}return l(t),d(),{set(a){n&&n.readyState===WebSocket.OPEN&&n.send(typeof a=="object"?JSON.stringify(a):a),u&&l(a)},update:y,subscribe:S}}function W(e,t,o={}){return{subscribe:f(e,t,o).subscribe}}const _={block:"",max_uid:2,mode:"editingA",exps:[s({},b),s({},b)],image_params:m(s({},h.takeimage),{fc:!1})},$=p({mode:"auto",connected:!1}),U=W(`ws://${window.location.hostname}:8000/status`,s({},O),{localStore:$}),k=p(s({},_)),C=f(`ws://${window.location.hostname}:8000/user`,s({},_),{beforeOpen:E}),q=f(`ws://${window.location.hostname}:8000/cmd`,{msg:"ok"},{broadcastOnSet:!1});async function E(){for(;;)try{const t=await(await fetch(`http://${window.location.hostname}:8000/usersettings`)).json();k.set(t);return}catch{console.error("Cannot get initial user settings.")}}function N(){let e=Date.now(),t=setTimeout(()=>{},1e3);k.subscribe(o=>{let u=Date.now();const c=()=>{C.set(o),e=Date.now()};u-e<1e3?(clearTimeout(t),t=setTimeout(c,1e3-(u-e))):c()})}N();export{h as a,q as c,b as e,I as f,$ as l,j as r,U as s,P as t,k as u};

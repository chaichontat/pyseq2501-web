var D=Object.defineProperty,W=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var w=(t,e,o)=>e in t?D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,n=(t,e)=>{for(var o in e||(e={}))x.call(e,o)&&w(t,o,e[o]);if(b)for(var o of b(e))z.call(e,o)&&w(t,o,e[o]);return t},u=(t,e)=>W(t,T(e));import{D as p}from"./vendor-9417e0b8.js";const k={pump:{reagent:"",volume:0,op:"pump"},prime:{reagent:"",volume:0,op:"prime"},temp:{temp:25,wait:!0,op:"temp"},hold:{time:0,op:"hold"},takeimage:{name:"Test",path:".",xy0:[0,0],xy1:[1,1],channels:[!0,!0,!0,!0],z_tilt:19850,z_obj:32e3,save:!1,lasers:[0,0],laser_onoff:[!0,!0],od:[0,0],overlap:.1,op:"takeimage",z_from:0,z_to:0,z_spacing:232},autofocus:{channels:[!0,!0,!0,!0],laser_onoff:!0,laser:5,od:0,op:"autofocus"},goto:{step:1,n:4,op:"goto"}},j={name:"",port:1,v_pull:100,v_prime:200,v_push:2e3,wait:26},h={name:"",path:".",fc:!1,reagents:[{uid:0,reagent:n({},j)}],cmds:[{uid:0,cmd:n({},k.pump)}]};function R(t,e){return{name:t.name,fc:t.fc,path:t.path,reagents:t.reagents.map(o=>({uid:++e,reagent:o})),cmds:t.cmds.map(o=>({uid:++e,cmd:o}))}}function U(t){return{name:t.name,fc:t.fc,path:t.path,reagents:t.reagents.map(e=>e.reagent),cmds:t.cmds.map(e=>e.cmd)}}const C={n:0,img:[""],hist:[{counts:[10],bin_edges:[0]}],channels:[!1,!1,!1,!1],dim:[0,0]},N={x:-1,y:-1,z_tilt:[-1,-1,-1],z_obj:-1,od:[0,0],laser_onoff:[!0,!0],lasers:[-1,-1],shutter:!1,msg:"Idle"};function _(t,e,{f:o=JSON.parse,beforeOpen:l,localStore:c}={}){let i,a;const{set:r,subscribe:d,update:g}=p(e);async function m(){console.log("Connecting"),a=null,i=new WebSocket(t),i.onmessage=s=>r(o(s.data)),i.onopen=async()=>{l&&await l(),c&&c.update(s=>u(n({},s),{connected:!0})),a&&(clearTimeout(a),a=null)},i.onclose=()=>{c&&c.update(s=>u(n({},s),{connected:!1})),a||(a=setTimeout(m,2e3)),console.error("Connection closed.")}}return m(),{set(s){i&&i.readyState===WebSocket.OPEN&&i.send(typeof s=="object"?JSON.stringify(s):s),r(s)},update:g,subscribe:d}}function E(t,e,o={}){return{subscribe:_(t,e,o).subscribe}}function O(t,e,o,{f:l=JSON.parse,beforeOpen:c,localStore:i}={}){let a,r;const{set:d,subscribe:g}=p(e);async function m(){console.log("Connecting"),r=null,c&&await c(),a&&a.close(),a=new WebSocket(t),a.onmessage=s=>d(l(s.data)),a.onopen=()=>{i&&i.update(s=>u(n({},s),{connected:!0})),r&&(clearTimeout(r),r=null)},a.onclose=()=>{i&&i.update(s=>u(n({},s),{connected:!1})),r||(r=setTimeout(m,2e3)),console.error("Connection closed.")}}return m(),{set(s){a&&a.readyState===WebSocket.OPEN&&(console.log(),a.send(typeof s=="object"?JSON.stringify(s):s))},update(){throw new Error("Cannot update an asymWritableWebSocket")},subscribe:g}}const y={block:"",max_uid:2,exps:[n({},h),n({},h)],image_params:u(n({},k.takeimage),{fc:!1})},S=p({mode:"automatic",connected:!1,img:n({},C)}),q=E(`ws://${window.location.hostname}:8000/status`,n({},N),{localStore:S}),f=p(n({},y)),$=_(`ws://${window.location.hostname}:8000/user`,n({},y),{beforeOpen:J}),v=O(`ws://${window.location.hostname}:8000/cmd`,{msg:"ok"});async function J(){for(;;)try{const e=await(await fetch(`http://${window.location.hostname}:8000/usersettings`)).json();f.set(e);return}catch{console.error("Cannot get initial user settings.")}}function B(){let t=Date.now(),e=setTimeout(()=>{},1e3);f.subscribe(o=>{let l=Date.now();const c=()=>{$.set(o),t=Date.now()};l-t<1e3?(clearTimeout(e),e=setTimeout(c,1e3-(l-t))):c()})}B();function I(t){t.msg==="imgReady"?(fetch(`http://${window.location.hostname}:8000/img`).then(e=>e.json()).then(e=>S.update(o=>u(n({},o),{img:e}))).catch(e=>alert(e)),f.update(e=>u(n({},e),{block:""}))):t.msg==="moveDone"&&f.update(e=>u(n({},e),{block:""}))}v.subscribe(I);export{k as a,v as c,h as e,R as f,S as l,j as r,q as s,U as t,f as u};

var N=Object.defineProperty,O=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var w=(e,t,s)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,r=(e,t)=>{for(var s in t||(t={}))z.call(t,s)&&w(e,s,t[s]);if(h)for(var s of h(t))C.call(t,s)&&w(e,s,t[s]);return e},S=(e,t)=>O(e,x(t));import{D as W}from"./vendor-de2b3913.js";const _={pump:{reagent:"",volume:0,op:"pump"},prime:{reagent:"",volume:0,op:"prime"},temp:{temp:25,wait:!0,op:"temp"},hold:{time:0,op:"hold"},takeimage:{name:"Test",path:".",xy0:[0,0],xy1:[1,1],channels:[!0,!0,!0,!0],z_tilt:19850,z_obj:32e3,save:!1,lasers:[0,0],laser_onoff:[!0,!0],od:[0,0],overlap:.1,op:"takeimage",z_from:0,z_to:0,z_spacing:232},autofocus:{channels:[!0,!0,!0,!0],laser_onoff:!0,laser:5,od:0,op:"autofocus"},goto:{step:1,n:4,op:"goto"}},j={name:"",port:1,v_pull:100,v_prime:200,v_push:2e3,wait:26},b={name:"",path:".",fc:!1,reagents:[{uid:0,reagent:r({},j)}],cmds:[{uid:0,cmd:r({},_.pump)}]};function v(e,t){return{name:e.name,fc:e.fc,path:e.path,reagents:e.reagents.map(s=>({uid:++t,reagent:s})),cmds:e.cmds.map(s=>({uid:++t,cmd:s}))}}function A(e){return{name:e.name,fc:e.fc,path:e.path,reagents:e.reagents.map(t=>t.reagent),cmds:e.cmds.map(t=>t.cmd)}}const J={x:-1,y:-1,z_tilt:[-1,-1,-1],z_obj:-1,od:[0,0],laser_onoff:[!0,!0],lasers:[-1,-1],shutter:!1,msg:""},d=[2e3,5e3,1e4,3e4,6e4];function g(e,t,s=a=>a,u=!0){let a,p,c,l=0;const i=new Set;function D(){const o=l;return l++,d[o>=d.length-1?d.length-1:o]}function y(){c&&clearTimeout(c),a.readyState!==WebSocket.CLOSED&&a.close()}function E(){y(),i.size>0&&(c=setTimeout(()=>f(),D()))}async function f(){return c&&(clearTimeout(c),c=void 0),a=new WebSocket(e),a.onmessage=o=>{console.log(o.data),i.forEach(n=>{t=s(o.data),n(t)})},a.onclose=o=>E(),p=new Promise((o,n)=>{a.onerror=m=>{console.error("Websocket error"),n(m)},a.onopen=m=>{l=0,o(!0)}}),p}return f(),{set(o){console.log(o);const n=typeof o=="object"?()=>a.send(JSON.stringify(o)):()=>a.send(o);if(a)switch(a.readyState){case(WebSocket.CLOSED||WebSocket.CLOSING):{f().then(n);break}case WebSocket.CONNECTING:{p.then(n);break}case WebSocket.OPEN:{n();break}}u&&i.forEach(m=>m(o))},update(o){i.forEach(n=>n(o(t)))},subscribe(o){return o(t),i.add(o),()=>i.delete(o)}}}const k={block:"",max_uid:2,mode:"editingA",exps:[r({},b),r({},b)],image_params:S(r({},_.takeimage),{fc:!1})},H=g(`ws://${window.location.hostname}:8000/status`,r({},J),e=>JSON.parse(e)),T=W(r({},k)),$=g(`ws://${window.location.hostname}:8000/user`,r({},k),e=>JSON.parse(e)),U=g(`ws://${window.location.hostname}:8000/cmd`,{msg:"ok"},e=>JSON.parse(e),!1);async function L(){try{const t=await(await fetch(`http://${window.location.hostname}:8000/usersettings`)).json();T.set(t)}catch{setTimeout(L,1e3),console.error("Cannot get initial user settings.")}}function P(){let e=Date.now(),t=setTimeout(()=>{},1e3);T.subscribe(s=>{let u=Date.now();const a=()=>{$.set(s),e=Date.now()};u-e<1e3?(clearTimeout(t),t=setTimeout(a,1e3-(u-e))):a()})}P();export{_ as a,U as c,b as e,v as f,L as i,j as r,H as s,A as t,T as u};

var W=Object.defineProperty,x=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var b=(t,e,o)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,s=(t,e)=>{for(var o in e||(e={}))j.call(e,o)&&b(t,o,e[o]);if(h)for(var o of h(e))C.call(e,o)&&b(t,o,e[o]);return t},u=(t,e)=>x(t,z(e));import{D as g}from"./vendor-9417e0b8.js";const y={pump:{reagent:"",volume:0,op:"pump"},prime:{reagent:"",volume:0,op:"prime"},temp:{temp:25,wait:!0,op:"temp"},hold:{time:0,op:"hold"},takeimage:{name:"Test",path:".",xy0:[0,0],xy1:[1,1],channels:[!0,!0,!0,!0],z_tilt:19850,z_obj:32e3,save:!1,lasers:[0,0],laser_onoff:[!0,!0],od:[0,0],overlap:.1,op:"takeimage",z_from:0,z_to:0,z_spacing:232},autofocus:{channels:[!0,!0,!0,!0],laser_onoff:!0,laser:5,od:0,op:"autofocus"},goto:{step:1,n:4,op:"goto"}},E={name:"",port:1,v_pull:100,v_prime:200,v_push:2e3,wait:26};function k(t){return{name:"",path:".",fc:!1,reagents:[{uid:t+1,reagent:s({},E)}],cmds:[{uid:t+2,cmd:s({},y.pump)}]}}function U(t,e){return{name:t.name,fc:t.fc,path:t.path,reagents:t.reagents.map(o=>({uid:++e,reagent:o})),cmds:t.cmds.map(o=>({uid:++e,cmd:o}))}}function q(t){return{name:t.name,fc:t.fc,path:t.path,reagents:t.reagents.map(e=>e.reagent),cmds:t.cmds.map(e=>e.cmd)}}const N={n:0,img:[""],hist:[{counts:[10],bin_edges:[0]}],channels:[!1,!1,!1,!1],dim:[0,0]},_={running:!1,step:0,msg:""},O={x:-1,y:-1,z_tilt:[-1,-1,-1],z_obj:-1,od:[0,0],laser_onoff:[!0,!0],lasers:[-1,-1],shutter:!1,fcs:[s({},_),s({},_)],block:"",msg:"Idle"};function S(t,e,{f:o=JSON.parse,beforeOpen:l,localStore:i,sendOnSet:m=!0}={}){let n,a;const{set:f,subscribe:w,update:p}=g(e);async function c(){console.log("Connecting"),a=null,n=new WebSocket(t),n.onmessage=r=>f(o(r.data)),n.onopen=async()=>{l&&await l(),i&&i.update(r=>u(s({},r),{connected:!0})),a&&(clearTimeout(a),a=null)},n.onclose=()=>{i&&i.update(r=>u(s({},r),{connected:!1})),a||(a=setTimeout(c,2e3)),console.error("Connection closed.")}}return c(),{set(r){m&&n&&n.readyState===WebSocket.OPEN&&n.send(typeof r=="object"?JSON.stringify(r):r),f(r)},update:p,subscribe:w}}function $(t,e,o,{f:l=JSON.parse,beforeOpen:i,localStore:m}={}){let n,a;const{set:f,subscribe:w}=g(e);async function p(){console.log("Connecting"),a=null,i&&await i(),n&&n.close(),n=new WebSocket(t),n.onmessage=c=>f(l(c.data)),n.onopen=()=>{m&&m.update(c=>u(s({},c),{connected:!0})),a&&(clearTimeout(a),a=null)},n.onclose=()=>{m&&m.update(c=>u(s({},c),{connected:!1})),a||(a=setTimeout(p,2e3)),console.error("Connection closed.")}}return p(),{set(c){n&&n.readyState===WebSocket.OPEN&&(console.log(),n.send(typeof c=="object"?JSON.stringify(c):c))},update(){throw new Error("Cannot update an asymWritableWebSocket")},subscribe:w}}const D={block:"",max_uid:6,exps:[k(0),k(3)],image_params:u(s({},y.takeimage),{fc:!1})},T=g({mode:"automatic",connected:!1,img:s({},N)}),A=S(`ws://${window.location.hostname}:8000/status`,s({},O),{localStore:T,sendOnSet:!1}),d=g(s({},D)),v=S(`ws://${window.location.hostname}:8000/user`,s({},D),{beforeOpen:B}),J=$(`ws://${window.location.hostname}:8000/cmd`,{msg:"ok"});async function B(){for(;;)try{const e=await(await fetch(`http://${window.location.hostname}:8000/usersettings`)).json();d.set(e);return}catch{console.error("Cannot get initial user settings.")}}function I(){let t=Date.now(),e=setTimeout(()=>{},1e3);d.subscribe(o=>{let l=Date.now();const i=()=>{v.set(o),t=Date.now()};l-t<1e3?(clearTimeout(e),e=setTimeout(i,1e3-(l-t))):i()})}I();function P(t){t.msg==="imgReady"?(fetch(`http://${window.location.hostname}:8000/img`).then(e=>e.json()).then(e=>T.update(o=>u(s({},o),{img:e}))).catch(e=>alert(e)),d.update(e=>u(s({},e),{block:""}))):t.msg==="moveDone"&&d.update(e=>u(s({},e),{block:""}))}J.subscribe(P);export{y as a,J as c,U as f,k as g,T as l,E as r,A as s,q as t,d as u};

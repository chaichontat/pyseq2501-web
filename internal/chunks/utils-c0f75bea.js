var j=Object.defineProperty,W=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var _=(t,e,n)=>e in t?j(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,o=(t,e)=>{for(var n in e||(e={}))N.call(e,n)&&_(t,n,e[n]);if(y)for(var n of y(e))L.call(e,n)&&_(t,n,e[n]);return t},i=(t,e)=>W(t,O(e));import{D as w,S as J,i as x,s as A,e as F,c as I,a as R,d as k,b as q,f as m,g as B,M as S}from"./vendor-86a163ee.js";const z={pump:{reagent:"",volume:0,op:"pump"},prime:{reagent:"",volume:0,op:"prime"},temp:{temp:25,wait:!0,op:"temp"},hold:{time:0,op:"hold"},takeimage:{name:"Test",path:".",xy0:[0,0],xy1:[1,1],channels:[!0,!0,!0,!0],z_tilt:19850,z_obj:32e3,save:!1,lasers:[0,0],laser_onoff:[!0,!0],od:[0,0],overlap:.1,op:"takeimage",z_from:0,z_to:0,z_spacing:232},autofocus:{channels:[!0,!0,!0,!0],laser_onoff:!0,laser:5,od:0,op:"autofocus"},goto:{step:1,n:4,op:"goto"}},P={name:"",port:1,v_pull:100,v_prime:200,v_push:2e3,wait:26};function v(t){return{name:"",path:".",fc:!1,reagents:[{uid:t+1,reagent:o({},P)}],cmds:[{uid:t+2,cmd:o({},z.pump)}]}}function te(t,e){return{name:t.name,fc:t.fc,path:t.path,reagents:t.reagents.map(n=>({uid:++e,reagent:n})),cmds:t.cmds.map(n=>({uid:++e,cmd:n}))}}function ne(t){return{name:t.name,fc:t.fc,path:t.path,reagents:t.reagents.map(e=>e.reagent),cmds:t.cmds.map(e=>e.cmd)}}const V={n:0,img:[""],hist:[{counts:[10],bin_edges:[0]}],channels:[!1,!1,!1,!1],dim:[0,0]},D={running:!1,step:0,msg:{msg:"",t:Date.now()}},M={x:-1,y:-1,z_tilt:[-1,-1,-1],z_obj:-1,od:[0,0],laser_onoff:[!0,!0],lasers:[-1,-1],shutter:!1,fcs:[o({},D),o({},D)],block:"",msg:{msg:"Error: not connected.",t:Date.now()},msg2:{msg:"",t:Date.now()}};function C(t,e,{f:n=JSON.parse,onOpen:a,localStore:c,sendOnSet:f=!0}={}){let s,r;const{set:g,subscribe:b,update:h}=w(e);async function u(){console.log("Connecting"),r=null,s=new WebSocket(t),s.onmessage=l=>g(n(l.data)),s.onopen=async()=>{a&&await a(),c&&c.update(l=>i(o({},l),{connected:!0})),r&&(clearTimeout(r),r=null)},s.onclose=()=>{c&&c.update(l=>i(o({},l),{connected:!1})),r||(r=setTimeout(u,2e3)),console.error("Connection closed.")}}return u(),{set(l){f&&s&&s.readyState===WebSocket.OPEN&&s.send(typeof l=="object"?JSON.stringify(l):l),g(l)},update:h,subscribe:b}}function U(t,e,n,{f:a=JSON.parse,beforeOpen:c,localStore:f}={}){let s,r;const{set:g,subscribe:b}=w(e);async function h(){console.log("Connecting"),r=null,c&&await c(),s&&s.close(),s=new WebSocket(t),s.onmessage=u=>g(a(u.data)),s.onopen=()=>{f&&f.update(u=>i(o({},u),{connected:!0})),r&&(clearTimeout(r),r=null)},s.onclose=()=>{f&&f.update(u=>i(o({},u),{connected:!1})),r||(r=setTimeout(h,2e3)),console.error("Connection closed.")}}return h(),{set(u){s&&s.readyState===WebSocket.OPEN&&(console.log(),s.send(typeof u=="object"?JSON.stringify(u):u))},update(){throw new Error("Cannot update an asymWritableWebSocket")},subscribe:b}}const E={block:"",max_uid:6,exps:[v(0),v(3)],image_params:i(o({},z.takeimage),{fc:!1})},p=w({mode:"automatic",connected:!1,img:o({},V),afimg:{afimg:Array(259).fill(""),laplacian:Array(259).fill(0)}}),se=C(`ws://${window.location.hostname}:8000/status`,o({},M),{localStore:p,onOpen:T,sendOnSet:!1}),d=w(o({},E)),G=C(`ws://${window.location.hostname}:8000/user`,o({},E),{onOpen:K}),H=U(`ws://${window.location.hostname}:8000/cmd`,{msg:"ok"});async function K(){for(;;)try{const e=await(await fetch(`http://${window.location.hostname}:8000/usersettings`)).json();d.set(e);return}catch{console.error("Cannot get initial user settings.")}}function Q(){let t=Date.now(),e=setTimeout(()=>{},1e3);d.subscribe(n=>{let a=Date.now();const c=()=>{G.set(n),t=Date.now()};a-t<1e3?(clearTimeout(e),e=setTimeout(c,1e3-(a-t))):c()})}Q();function X(t){t.msg==="imgReady"?(fetch(`http://${window.location.hostname}:8000/img`).then(e=>e.json()).then(e=>p.update(n=>i(o({},n),{img:e}))).catch(e=>alert(e)),d.update(e=>i(o({},e),{block:""}))):t.msg==="afimgReady"?(fetch(`http://${window.location.hostname}:8000/afimg`).then(e=>e.json()).then(e=>p.update(n=>i(o({},n),{afimg:e}))).catch(e=>alert(e)),d.update(e=>i(o({},e),{block:""}))):t.msg==="moveDone"&&d.update(e=>i(o({},e),{block:""}))}H.subscribe(X);async function T(){fetch(`http://${window.location.hostname}:8000/img`).then(t=>t.json()).then(t=>p.update(e=>i(o({},e),{img:t}))).catch(()=>{}),fetch(`http://${window.location.hostname}:8000/afimg`).then(t=>t.json()).then(t=>p.update(e=>i(o({},e),{afimg:t}))).catch(()=>{})}T();function Y(t){let e;return{c(){e=F("div"),this.h()},l(n){e=I(n,"DIV",{class:!0,style:!0}),R(e).forEach(k),this.h()},h(){q(e,"class","transition-all circle svelte-ocwmti"),m(e,"--size",t[0]),m(e,"--color",t[1]),m(e,"--duration",t[2])},m(n,a){B(n,e,a)},p(n,[a]){a&1&&m(e,"--size",n[0]),a&2&&m(e,"--color",n[1]),a&4&&m(e,"--duration",n[2])},i:S,o:S,d(n){n&&k(e)}}}function Z(t,e,n){let{size:a="1rem"}=e,{color:c="blue"}=e,{duration:f="1.5s"}=e;return t.$$set=s=>{"size"in s&&n(0,a=s.size),"color"in s&&n(1,c=s.color),"duration"in s&&n(2,f=s.duration)},[a,c,f]}class oe extends J{constructor(e){super();x(this,e,Z,Y,A,{size:0,color:1,duration:2})}}function ae(t){requestAnimationFrame(()=>{t&&(t.style.transition="none",t.style.backgroundColor="rgba(255,62,0,0.3)",setTimeout(()=>{t.style.transition="background 1s",t.style.backgroundColor=""}))})}function ie(t){return t.reduce((e,n)=>i(o({},e),{[n]:(e[n]||0)+1}),{})}function ce(t,e=[0,1/0]){const n=()=>{const a=parseFloat(t.value);e[0]<=a&&a<=e[1]?t.classList.remove("invalid"):t.classList.add("invalid")};return document.addEventListener("input",n),{destroy:()=>{document.removeEventListener("input",n)}}}export{oe as S,ce as a,ie as b,H as c,z as d,te as e,ae as f,v as g,p as l,P as r,se as s,ne as t,d as u};
